{"version":2,"kind":"Notebook","sha256":"8a4c9a331d03ef0d643b8f79bbe08b25edf3f09755e2d74b1e8e5e1496e6cf50","slug":"notebooks.snowdepth","location":"/notebooks/snowdepth.ipynb","dependencies":[],"frontmatter":{"title":"Snow Depth Applications","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"default","language":"python"},"authors":[{"nameParsed":{"literal":"ICESat-2 team","given":"ICESat-2","family":"team"},"name":"ICESat-2 team","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/ICESAT-2HackWeek/icesat2-cookbook","copyright":"2025","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/ICESAT-2HackWeek/icesat2-cookbook/blob/HEAD/notebooks/snowdepth.ipynb","edit_url":"https://github.com/ICESAT-2HackWeek/icesat2-cookbook/edit/HEAD/notebooks/snowdepth.ipynb","exports":[{"format":"ipynb","filename":"snowdepth.ipynb","url":"/icesat2-cookbook/_preview/38/build/snowdepth-5baf28013560252164927fba77f39f44.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Author(s)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uOucaEt9gk"}],"identifier":"author-s","label":"Author(s)","html_id":"author-s","implicit":true,"key":"gOS38gEgYX"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Karina Zikan, Zach Fair","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HM0akywH5i"}],"key":"HEp6gdZDhS"},{"type":"heading","depth":2,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Learning Outcomes","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Edk9oW4hvS"}],"identifier":"learning-outcomes","label":"Learning Outcomes","html_id":"learning-outcomes","implicit":true,"key":"MBbetEXYpp"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Gain experience in working with SlideRule to access and pre-process ICESat-2\ndata","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jWffvg3SSI"}],"key":"aQG0wrU8cK"}],"key":"Z7h3PwmXLn"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Learn how to use projections and interpolation to compare ICESat-2 track data\nwith gridded raster products","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"G52NtiaY5u"}],"key":"BzFd4gFkGn"}],"key":"OH8po4Tnif"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Develop a general understanding of how to measure snow depths with LiDAR,\nand learn about opportunities and challenges when using ICEsat-2 along-track\nproducts","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"KF0Vdn6VWa"}],"key":"MflpkjLjWu"}],"key":"NXA1jArYfc"}],"key":"ASEP9H71wJ"}],"key":"K64lSBZBqn"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Background","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VBNiYDlfEO"}],"identifier":"background","label":"Background","html_id":"background","implicit":true,"key":"wApmciwjkk"},{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"How do we measure snow depth with LiDAR?","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"aFy43vRynP"}],"identifier":"how-do-we-measure-snow-depth-with-lidar","label":"How do we measure snow depth with LiDAR?","html_id":"how-do-we-measure-snow-depth-with-lidar","implicit":true,"key":"wOiPWcmgFi"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"LiDAR is a useful tool for collecting high resolution snow depth maps over large spatial areas.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"q8b3c70thj"}],"key":"V0ykcwQDDn"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Snow depth is measured from LiDAR by differencing a snow-free LiDAR map from a snow-covered LiDAR map of the same area of interest.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uDWrs3aC3H"}],"key":"C5MY8DM1YQ"}],"key":"v9XEZfiSkf"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"TODO: Insert Figure 6 from Deems et al. here","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BSgwqI67kK"}],"key":"QePNekPZ1n"}],"key":"mQRh2vBzIy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"TODO: Insert Figure 7b from Deems et al","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ym7IzlLrJ5"}],"key":"xuw2HDU5Km"}],"key":"VOwbIwFeNw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Can we do this with ICESat-2?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pLsHToeTw1"}],"identifier":"can-we-do-this-with-icesat-2","label":"Can we do this with ICESat-2?","html_id":"can-we-do-this-with-icesat-2","implicit":true,"key":"OgqanRfVRq"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Yes! By differencing snow-covered ICESat-2 transects from snow-free maps, we can calculate snow depth!","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"tkjeYbryu0"}],"key":"FduLiHAsBr"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Performing the calculation with ICESat-2 is a little different from other LiDAR snow depth methods, given that ICESat-2 is a transect of points rather than gridded raster data. ICESat-2 also has sparse coverage in the mid-latitudes, so generating an effective snow-covered or snow-free map will be difficult.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zF5Gl0Xm3r"}],"key":"pQx2xH8bCq"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Because of these limitations, we need an independently-collected snow-free map of a region of interest for comparison. We also need to process the snow-free data into a form that can be differenced from snow-on ICESat-2 data.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"gg6UUHSp2n"}],"key":"jjgEnkRthg"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"In this tutorial, we will show an example of how to compare ICESat-2 data to raster data.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"y8FFX1wNWk"}],"key":"LvUC2HeF8a"}],"key":"wPDuPEQNCX"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"TODO: Add Karina’s image over Dry Creek","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Y0D2qRHFnz"}],"key":"LzUMPo04Fj"}],"key":"UfOvifcKUK"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"What do we need to calculate snow depth from ICESat-2?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lHKDm4wlg2"}],"identifier":"what-do-we-need-to-calculate-snow-depth-from-icesat-2","label":"What do we need to calculate snow depth from ICESat-2?","html_id":"what-do-we-need-to-calculate-snow-depth-from-icesat-2","implicit":true,"key":"qwMpojms7m"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A region of interest, where snow-free (and snow-covered, for validation) digital elevation models (DEMs) are available.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"djhU2k2Cl9"}],"key":"m3UD560YZS"}],"key":"pmqtnMw7Vc"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ICESat-2 data, ideally from one of the lower-level products (ATL03, ATL06, ATL08, Sliderule Earth).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dzu64a2u97"}],"key":"AJIEYpxbAg"}],"key":"WgrHClInHV"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A snow-free reference DEM for the snow depth calculation.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"kAQRn9x5P5"}],"key":"yDXX5G0G4I"}],"key":"VcKKzjK9JV"}],"key":"zKbVBkeh2x"}],"key":"pMVGskDQMw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"What do we need to consider when comparing ICESat-2 and raster data?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"atQDnOd1Sj"}],"identifier":"what-do-we-need-to-consider-when-comparing-icesat-2-and-raster-data","label":"What do we need to consider when comparing ICESat-2 and raster data?","html_id":"what-do-we-need-to-consider-when-comparing-icesat-2-and-raster-data","implicit":true,"key":"IB7DbPyTc2"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Geolocation","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"sh1y5bIOnZ"}],"key":"xv5giUm3Ot"},{"type":"text","value":": To obtain usable results, it is important that we properly align the snow-free raster data with ICESat-2. Even small offsets can create large errors that worsen in rugged terrain.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"uSE5vVJs42"}],"key":"jrQxRv7kdL"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"TODO: Add Figure 9 from Nuth and Kabb","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"kdoZ4PujMw"}],"key":"YTrdpyc1kN"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Vegetation","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"niJPrjz5O0"}],"key":"WVBswRmHGI"},{"type":"text","value":": Incorrectly categorized vegetation returns can positively bias ground or snow surface height estimation. Additionally, dense vegetation can reduce the number of photon returns, thereby increasing uncertainty in our height estimates.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"P4IXccPnhG"}],"key":"JXmIaQH9v9"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Slope Effects","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"NHjT1Y4iED"}],"key":"Rgu2Cer02v"},{"type":"text","value":": Rugged terrain increases uncertainty in ICESat-2 returns and increases the impact of geolocation offsets between ICESat-2 and raster data. Additionally, steep slopes can negatively bias ground or snow surface height estimates.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"cvSHMh3dy7"}],"key":"hWS0tR2Tcs"}],"key":"SQ5uuZX8aR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Computing Environment","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dC3QPTWYdv"}],"identifier":"computing-environment","label":"Computing Environment","html_id":"computing-environment","implicit":true,"key":"yihTe2Pdhe"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We’ll be using the following open source Python libraries in this notebook:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"j7Vk5JvIpm"}],"key":"WcRTVoqBId"}],"key":"U33uBhjbeu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport pandas as pd\nimport geopandas as gpd\nimport rioxarray as rxr\nimport matplotlib.pyplot as plt\nfrom sliderule import icesat2, sliderule\nfrom scipy.interpolate import RectBivariateSpline","key":"zsKOtByA3v"},{"type":"output","id":"e1utn7Nz9QZsnjVr0vwVj","data":[],"key":"WkWYQCu6Gw"}],"key":"wGTX6jdntk"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xKExrdCzbV"}],"identifier":"data","label":"Data","html_id":"data","implicit":true,"key":"CTD8cq5lGx"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We will use SlideRule to acquire customized ATL06 data. Specific customizations that we will implement include footprint averaging (i.e., along-track sampling rate) and photon identification (signal/noise and ground/vegetation).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"IrtJrphbDj"}],"key":"D2TP2I3Iwh"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We will look at snow depth data over Upper Kuparuk/Toolik (UKT) on the Arctic North Slope of Alaska. Because UKT is a relatively flat region with little vegetation, we should expect good agreement between ICESat-2 and our rasters of interest.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"jNHLTla1iV"}],"key":"vnr2RPLiQW"}],"key":"k9Q79h1SLv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Initialize SlideRule","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cWc783hVDp"}],"identifier":"initialize-sliderule","label":"Initialize SlideRule","html_id":"initialize-sliderule","implicit":true,"key":"yu4KYlCqLq"}],"key":"abNAfrSZKl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"icesat2.init(\"slideruleearth.io\")","key":"CBQPpTiEzc"},{"type":"output","id":"toJ-eKAvGyoXCurijQ_NO","data":[{"output_type":"stream","name":"stderr","text":"Warning, this environment is using an outdated client (v4.19.1). The code will run but some functionality supported by the server (v4.20.0) may not be available.\n"},{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"OzdzR9kcEV"}],"key":"Nnqungcpvh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define Region of Interest","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XY1ffva1Vi"}],"identifier":"define-region-of-interest","label":"Define Region of Interest","html_id":"define-region-of-interest","implicit":true,"key":"rTf0l3xvv4"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"After we initialize SlideRule, we define our region of interest. Notice that there are two options given below. This is because SlideRule accepts either the coordinates of a box/polygon or a geoJSON for its ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TK09FotGPq"},{"type":"inlineCode","value":"region","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hYOMI9oc0r"},{"type":"text","value":" input.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"M6ubNeh3lF"}],"key":"avKCai01fE"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We are going to use the bounding box method in this tutorial, but the syntax for the geoJSON method is included for the user’s reference.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zXEkDa39LS"}],"key":"thVsC9qyVp"}],"key":"QPX8Yz0BFO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define region of interest over Toolik, Alaska\nregion = [{\"lon\":-149.5992624418217, \"lat\":68.63358948385529}, \n          {\"lon\":-149.5954459662985, \"lat\":68.60200878043223}, \n          {\"lon\":-149.2821268688734, \"lat\":68.60675802967609}, \n          {\"lon\":-149.2855031235162, \"lat\":68.63834638180673},\n          {\"lon\":-149.5992624418217, \"lat\":68.63358948385529}]\n\nprint(region)","key":"voE5pzbvUC"},{"type":"output","id":"N_fDAJIayTnF755qBUiIY","data":[{"output_type":"stream","name":"stdout","text":"[{'lon': -149.5992624418217, 'lat': 68.63358948385529}, {'lon': -149.5954459662985, 'lat': 68.60200878043223}, {'lon': -149.2821268688734, 'lat': 68.60675802967609}, {'lon': -149.2855031235162, 'lat': 68.63834638180673}, {'lon': -149.5992624418217, 'lat': 68.63358948385529}]\n"}],"key":"ijA38H1aJI"}],"key":"vGAvAnrePA"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"qe76WLm4Om"}],"key":"p24p04I4yk"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Here’s an alternate method, with geoJSON:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"zScE9rSZzo"}],"key":"i4tLhe7xLk"},{"type":"code","lang":"python","value":"path = \"/path/to/geojson/\"\nregion = sliderule.toregion(path)[\"poly\"]\nprint(region)","position":{"start":{"line":4,"column":1},"end":{"line":7,"column":1}},"key":"g43z8z8Yj5"}],"key":"w5wx5cBzQd"}],"key":"Bnj9sbQsWI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Build SlideRule Request","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wBtr9hzDx1"}],"identifier":"build-sliderule-request","label":"Build SlideRule Request","html_id":"build-sliderule-request","implicit":true,"key":"GBe8hfgH2T"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Now we are going to build our SlideRule request by defining ICESat-2 parameters.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nDdo0yRSVx"}],"key":"q51g4VwvLF"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Since we want something close to the ATL06 product, we will use the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Qa4BmaCjbn"},{"type":"inlineCode","value":"icesat2.atl06p()","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"b53ARjTASf"},{"type":"text","value":" function in this tutorial. You can find other SlideRule functions and more detail on the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"WVACznrjxI"},{"type":"inlineCode","value":"icesat2.atl06p()","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"CqFFV5fZaG"},{"type":"text","value":" function on the SlideRule API reference. (TODO: Add link to API reference)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"PhDnKNUGEJ"}],"key":"uxhlCNdPC5"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"We won’t use every parameter in this tutorial, but here is a reference list for some of them. More information can be found in the SlideRule users guide (TODO: Add link to users guide)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"sS5Qd9zP5y"}],"key":"KLf4HxGIW3"}],"key":"jdDocGAFYH"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Parameters","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"BvJEsgPnv3"}],"key":"wPnY4f74zB"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"poly","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FwLqjnAzTH"},{"type":"text","value":": Polygon defining region of interest.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gWbDZrXNvw"}],"key":"m5yenOOhxx"}],"key":"pkDfcOS1be"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"track","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"OVc59AWtEH"},{"type":"text","value":": Reference pair track number (1, 2, 3; 0 to include all three; defaults to 0).","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"RLiLnqyvdk"}],"key":"anBxd6M2aJ"}],"key":"a2WgZEnake"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"rgt","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"reIh9wBmUu"},{"type":"text","value":": Reference ground track (defaults to all).","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fGL2sxOSPj"}],"key":"leuICqceNs"}],"key":"nhEeM4kYmP"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"cycle","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"EKX8J1Ltho"},{"type":"text","value":": Counter of 91-day repeat cycles completed by the mission (defaults to all).","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"GJ68o5HgCm"}],"key":"rwpkBzMvpg"}],"key":"oYQ58MtxeW"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"region","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"NyJhiOpguT"},{"type":"text","value":": Geographic region for data product (defaults to global).","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"yqVxSCfI6h"}],"key":"Y4N9kj4zau"}],"key":"qXf9ooPLyf"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"t0","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"VEiPTzmFOk"},{"type":"text","value":": Start time for filtering granules (%Y-%m%dT%h:%M:%SZ format)","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"NncPhNR12D"}],"key":"YjpsHZ8c5Z"}],"key":"qKK58eBKo4"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"t1","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"sE4ilZTXJC"},{"type":"text","value":": Stop time for filtering granules (%Y-%m%dT%h:%M:%SZ format).","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"fdfNhPo7zL"}],"key":"d6x8m0EeBW"}],"key":"iH5zt8y1vv"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"srt","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"CsBQqJpfJ9"},{"type":"text","value":": Surface type (0=land, 1=ocean, 2=sea ice, 3=land ice, 4=inland water).","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"K3po5bBppM"}],"key":"CwlBpO9g7r"}],"key":"xP2YUXt0AT"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"cnf","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"qFZrIk2kGA"},{"type":"text","value":": Confidence level for photon selection, in integer or list format.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"aKwBjffBEi"}],"key":"aKB00S03xQ"}],"key":"aR7gbeqOKf"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"atl08_class","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"wtjLUyHjNz"},{"type":"text","value":": List of ATL08 classifications for photon processing (“atl08_noise”, “atl08_ground”, “atl08_canopy”, “atl08_top_of_canopy”, “atl08_unclassified”).","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"NgxSEya2zT"}],"key":"SnoGmw253A"}],"key":"cMN9ed8aaM"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"maxi","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"PnV59hV1cV"},{"type":"text","value":": Maximum interations of algorithm, not including initial least-squares-fit selection.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Or8dDrvvS5"}],"key":"tTDWu4G8ir"}],"key":"hJXgzK2Drh"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"H_min_win","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"vSqCKZnttd"},{"type":"text","value":": Minimum height to which the refined photon-selection window is allowed to shrink, in meters.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"EYoDP5puFP"}],"key":"n4Kc9x4ZCe"}],"key":"Rl9YavIhOR"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"sigma_r_max","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"wJJ8kPYzV8"},{"type":"text","value":": Maximum robust spread (uncertainty) in meters.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"TeDDsIWwqK"}],"key":"Rja954gjLY"}],"key":"G9uTs5BeN0"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"compact","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"BZCLG2tqfC"},{"type":"text","value":": Return results without most metadata.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"lTg4QkkI8x"}],"key":"ho2DAVgEfn"}],"key":"pafJy82ccx"}],"key":"E2k7AM2s0o"}],"key":"ggjv5uIBqa"}],"key":"wnzn6wnbKq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Build SlideRule request\n# Define parameters (described below)\nparms = {\n    \"poly\": region,\n    \"srt\": icesat2.SRT_LAND,\n    \"cnf\": icesat2.CNF_SURFACE_HIGH,\n    \"atl08_class\": [\"atl08_ground\"],\n    \"ats\": 5.0,\n    \"len\": 20.0,\n    \"res\": 10.0,\n    \"maxi\": 5\n}\n\n# Calculated ATL06 dataframe\nis2_df = icesat2.atl06p(parms)\n\n# Print SlideRule output\nprint(is2_df.head())","key":"x3wxNkv26O"},{"type":"output","id":"Z56YAUJ5RHn5fpy4fP40F","data":[{"output_type":"stream","name":"stdout","text":"                               cycle      h_mean   h_sigma  rms_misfit  \\\ntime                                                                     \n2018-10-20 00:56:22.190402560      1  954.390111  0.058245    0.300781   \n2018-10-20 00:56:22.191812864      1  954.540931  0.043303    0.216516   \n2018-10-20 00:56:22.193223680      1  954.353795  0.035662    0.185165   \n2018-10-20 00:56:22.194635776      1  954.267078  0.037516    0.201655   \n2018-10-20 00:56:22.196046080      1  954.076347  0.039337    0.218579   \n\n                                     y_atc  spot  n_fit_photons  rgt  region  \\\ntime                                                                           \n2018-10-20 00:56:22.190402560 -4502.958984     2             27  327       3   \n2018-10-20 00:56:22.191812864 -4502.944824     2             25  327       3   \n2018-10-20 00:56:22.193223680 -4502.937012     2             27  327       3   \n2018-10-20 00:56:22.194635776 -4502.930664     2             29  327       3   \n2018-10-20 00:56:22.196046080 -4502.927734     2             31  327       3   \n\n                               gt      x_atc  pflags  segment_id  \\\ntime                                                               \n2018-10-20 00:56:22.190402560  50  7650522.0       0      381674   \n2018-10-20 00:56:22.191812864  50  7650532.0       0      381675   \n2018-10-20 00:56:22.193223680  50  7650542.0       0      381675   \n2018-10-20 00:56:22.194635776  50  7650552.0       0      381676   \n2018-10-20 00:56:22.196046080  50  7650562.0       0      381676   \n\n                               w_surface_window_final  dh_fit_dx  \\\ntime                                                               \n2018-10-20 00:56:22.190402560                     3.0   0.051936   \n2018-10-20 00:56:22.191812864                     3.0  -0.026959   \n2018-10-20 00:56:22.193223680                     3.0  -0.011005   \n2018-10-20 00:56:22.194635776                     3.0  -0.010565   \n2018-10-20 00:56:22.196046080                     3.0  -0.019765   \n\n                                                  geometry  \ntime                                                        \n2018-10-20 00:56:22.190402560  POINT (-149.49734 68.60363)  \n2018-10-20 00:56:22.191812864  POINT (-149.49737 68.60372)  \n2018-10-20 00:56:22.193223680   POINT (-149.4974 68.60381)  \n2018-10-20 00:56:22.194635776   POINT (-149.49743 68.6039)  \n2018-10-20 00:56:22.196046080  POINT (-149.49745 68.60399)  \n"}],"key":"fwgQXdRTfW"}],"key":"Zkte49wpWp"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"TrLGBjRmSs"}],"key":"QIySnhudLy"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We defined our ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"GxxmuwwEMF"},{"type":"inlineCode","value":"region","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Tr2hiZ2joV"},{"type":"text","value":" above, so let’s run through the remaining parameters in our query:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rvwsFHY0Sk"}],"key":"R812Amra5m"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"srt","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"VTl2YKeIS3"},{"type":"text","value":": Only land photons will be considered.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vJ7a9zEo0k"}],"key":"Sq7A0OAMfs"}],"key":"rmkcBnFVNG"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"cnf","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"PRPrv6k5YK"},{"type":"text","value":": Only high-confidence photons.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"e3KR7GCLHq"}],"key":"tKRH56g4sL"}],"key":"So619DFr8q"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"atl08_class","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"BDrzE20Lgm"},{"type":"text","value":": Only ground photons, as identified by the ATL08 algorithm.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"H4efCVRDWv"}],"key":"XkjknmjoGm"}],"key":"zAVsLyaTUt"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"ats","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"NK9GhtcjLl"},{"type":"text","value":": The maximum along-track spread (uncertainty) in aggregated photons will be 5 m.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ngS4edtmEm"}],"key":"T97wUwGQmg"}],"key":"NMTTlggHxD"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"len","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"gDMJHfVd2Y"},{"type":"text","value":": The length of each segment of aggregated photons will be 20 m.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"wUfWMl3IKE"}],"key":"EyesnmRh83"}],"key":"rdyCCo978f"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"res","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jqHfCZ30ZF"},{"type":"text","value":": The along-track resolution will be 10 m. Because each segment will be 20 m long, there will be overlap between successive data points.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jBUPwq7cpz"}],"key":"Z9KU0HBmMI"}],"key":"nXs0eNOC0P"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"maxi","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"EDZLkZNc8G"},{"type":"text","value":": The SlideRule refinement algorithm will iterate 5 times per segment at maximum.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"psp3szajYl"}],"key":"D6ZxreHUSb"}],"key":"nMqcCDnQN1"}],"key":"ZhyW4pZsQU"}],"key":"vZO9H72UMr"}],"key":"shv1ofKriJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Subsetting the Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V99jifvdSf"}],"identifier":"subsetting-the-data","label":"Subsetting the Data","html_id":"subsetting-the-data","implicit":true,"key":"ggt5VVwX02"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"One may notice that the algorithm took a long time to generate the GeoDataFrame. That is because (i) our region of interest was rather large and (ii) we obtained all ICESat-2 tracks in the ROI since its launch (2018).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nP515Dt3iH"}],"key":"Lv1L3Hv1lC"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For the sake of interest, let’s take a look at all of the ICESat-2 tracks over Upper Kuparuk/Toolik.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Sp4ki4LyB9"}],"key":"HdwntT8pBh"}],"key":"G2E1TAWBEz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import contextily as ctx\nfrom shapely.geometry import Polygon\n\n# Convert region to a Polygon\ncoords = [(point[\"lon\"], point[\"lat\"]) for point in region]\npolygon = Polygon(coords)\nregion_gdf = gpd.GeoDataFrame([1], geometry=[polygon], crs=\"EPSG:4326\")\n\n# Reproject to Web Mercator for contextily\nis2_df_mercator = is2_df.to_crs(epsg=3857)\nregion_mercator = region_gdf.to_crs(epsg=3857)\n\n\nfig, ax = plt.subplots(figsize=(12, 8))\n# Plot surface height\nis2_df_mercator.plot(column='h_mean', \n                  ax=ax, \n                  cmap='viridis',\n                  legend=True,\n                  markersize=10,\n                  alpha=0.8)\n\n# Plot the region bounding box\nregion_mercator.plot(ax=ax, \n                     facecolor='none', \n                     edgecolor='red', \n                     linewidth=2)\n\n# Add ESRI World Imagery basemap\nctx.add_basemap(ax, \n                crs=is2_df_mercator.crs, \n                source=ctx.providers.Esri.WorldImagery)\nplt.tight_layout()\nplt.show()","key":"xGKSbdZ2Cf"},{"type":"output","id":"wHmPhV4BP2RGhkwttL6OX","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"6c8eb5596267578ac70253d37dc33aa7","path":"/icesat2-cookbook/_preview/38/build/6c8eb5596267578ac70253d37dc33aa7.png"}}}],"key":"sE5zkbiix9"}],"key":"ZkbfXmEbRg"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"It is cool to see all of the available data, but we only have snow-free lidar DEMs available from March 2022. So, we are going to subset the data to include one ICESat-2 track (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PXdWsz5zDy"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"RGT 152","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JzEetiEIH8"}],"key":"zLau56ZWNT"},{"type":"text","value":") in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qYfCumZ321"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"March 2023","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A4ktu20hui"}],"key":"ndeZgVxdbF"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pVAYRqlZTw"}],"key":"S8YqhtmWLO"}],"key":"XeAwDeVLHx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Subset ICESat-2 data to single RGT, time of year\nis2_df_subset = is2_df[is2_df['rgt']==152]\nis2_df_subset = is2_df_subset.loc['2023-03-31']\n\n# Display top of dataframe\nprint(is2_df_subset.head())","key":"To2HsKYj03"},{"type":"output","id":"eHd3WBrkl-G_taZqYfbLY","data":[{"output_type":"stream","name":"stdout","text":"                               cycle      h_mean   h_sigma  rms_misfit  \\\ntime                                                                     \n2023-03-31 08:03:54.300458240     19  837.299826  0.036000    0.252085   \n2023-03-31 08:03:54.301870848     19  836.776278  0.038032    0.273711   \n2023-03-31 08:03:54.303283200     19  836.143292  0.041716    0.265001   \n2023-03-31 08:03:54.304697600     19  835.636543  0.050364    0.293191   \n2023-03-31 08:03:54.306111744     19  835.219543  0.048279    0.301158   \n\n                                      y_atc  spot  n_fit_photons  rgt  region  \\\ntime                                                                            \n2023-03-31 08:03:54.300458240 -20939.156250     1             51  152       5   \n2023-03-31 08:03:54.301870848 -20939.173828     1             52  152       5   \n2023-03-31 08:03:54.303283200 -20939.193359     1             41  152       5   \n2023-03-31 08:03:54.304697600 -20939.203125     1             34  152       5   \n2023-03-31 08:03:54.306111744 -20939.205078     1             40  152       5   \n\n                               gt       x_atc  pflags  segment_id  \\\ntime                                                                \n2023-03-31 08:03:54.300458240  10  12418799.0       0      620001   \n2023-03-31 08:03:54.301870848  10  12418809.0       0      620002   \n2023-03-31 08:03:54.303283200  10  12418819.0       0      620002   \n2023-03-31 08:03:54.304697600  10  12418829.0       0      620003   \n2023-03-31 08:03:54.306111744  10  12418839.0       0      620003   \n\n                               w_surface_window_final  dh_fit_dx  \\\ntime                                                               \n2023-03-31 08:03:54.300458240                     3.0  -0.047823   \n2023-03-31 08:03:54.301870848                     3.0  -0.053057   \n2023-03-31 08:03:54.303283200                     3.0  -0.073967   \n2023-03-31 08:03:54.304697600                     3.0  -0.032487   \n2023-03-31 08:03:54.306111744                     3.0  -0.048137   \n\n                                                  geometry  \ntime                                                        \n2023-03-31 08:03:54.300458240  POINT (-149.35922 68.63719)  \n2023-03-31 08:03:54.301870848   POINT (-149.35924 68.6371)  \n2023-03-31 08:03:54.303283200  POINT (-149.35927 68.63701)  \n2023-03-31 08:03:54.304697600   POINT (-149.3593 68.63693)  \n2023-03-31 08:03:54.306111744  POINT (-149.35933 68.63684)  \n"}],"key":"DMHUliPC0A"}],"key":"vZeQOQ4aAE"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Sample the Lidar DTM to ICESat-2 ground track","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cIkgIQoAeK"}],"identifier":"sample-the-lidar-dtm-to-icesat-2-ground-track","label":"Sample the Lidar DTM to ICESat-2 ground track","html_id":"sample-the-lidar-dtm-to-icesat-2-ground-track","implicit":true,"key":"XRyOl2OVDT"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The ICESat-2 data is ready to go! Now it’s time to load the airborne lidar data, and co-register it with ICESat-2.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yNkGZ0obAA"}],"key":"fSMiHmwDeZ"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The lidar data used here is from the University of Alaska, Fairbanks (UAF). The UAF lidar obtains snow-on and snow-off DEMs/digital terrain models (DTMs) with a 1064 nm (near-infrared) laser, from which it can also derive snow depth.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ckjcKtVQVI"}],"key":"MXoHdF6qFj"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"UAF lidar rasters normally have a spatial resolution of 0.5 m, which can take a long time to process. As a compromise between computation speed and resolution, we will coarsen the rasters to 3 m resolution.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"B9hGhXiIKx"}],"key":"ABxmtZdruU"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The best way to handle lidar DEMs/DTMs is through ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"b3pS81sOxk"},{"type":"inlineCode","value":"rioxarray","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"DDUHNivHHn"},{"type":"text","value":":","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"l7DBPdALAY"}],"key":"KQwy2cO2nh"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"TODO: Access UAF lidar data without needing it locally.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"zoWaLjTz8B"}],"key":"Pcz6pQkca0"}],"key":"U0ghY6sqE3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import earthaccess\nearthaccess.login(strategy='interactive', persist=True)\nauth = earthaccess.login()","key":"LvHwPsVMbn"},{"type":"output","id":"soyZpxAh8L8836tpZLxHn","data":[],"key":"tgpC2f2lK0"}],"key":"E2GM8flN1S"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Coordinates for SW/NE corners\nlon_min = min([coord[0] for coord in coords])\nlat_min = min([coord[1] for coord in coords])\nlon_max = max([coord[0] for coord in coords])\nlat_max = max([coord[1] for coord in coords])\n\n# Data query for lidar point clouds over Fairbanks, AK\nresults = earthaccess.search_data(\n    short_name='SNEX23_Lidar',\n    bounding_box = (lon_min, lat_min, lon_max, lat_max),\n    temporal = ('2023-03-13', '2023-03-14')\n)","key":"MHnzWJM7XB"},{"type":"output","id":"ofNJdILVi6H_CmH5pxSoQ","data":[],"key":"TGPlmt2YNN"}],"key":"s9deqoqOn2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# File paths for UAF rasters (TODO: Add lidar files, and update names)\ntifpath = \"/your/path/here\"\nf_snow_off = f\"{tifpath}/uaf_lidar_snowoff.tif\"\nf_snow_on = f\"{tifpath}/uaf_lidar_snowon.tif\"\n\n# Load files as rioxarray datasets\nlidar_snow_off = rxr.open_rasterio(f_snow_off)\nlidar_snow_on = rxr.open_rasterio(f_snow_on)","key":"TAws6rY1kd"},{"type":"output","id":"MHsLr1nOPueQkq2bciKZn","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/icesat2-cookbook-dev/lib/python3.13/site-packages/xarray/backends/file_manager.py:219\u001b[39m, in \u001b[36mCachingFileManager._acquire_with_cache_info\u001b[39m\u001b[34m(self, needs_lock)\u001b[39m\n\u001b[32m    218\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m219\u001b[39m     file = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_cache\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_key\u001b[49m\u001b[43m]\u001b[49m\n\u001b[32m    220\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mKeyError\u001b[39;00m:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/icesat2-cookbook-dev/lib/python3.13/site-packages/xarray/backends/lru_cache.py:56\u001b[39m, in \u001b[36mLRUCache.__getitem__\u001b[39m\u001b[34m(self, key)\u001b[39m\n\u001b[32m     55\u001b[39m \u001b[38;5;28;01mwith\u001b[39;00m \u001b[38;5;28mself\u001b[39m._lock:\n\u001b[32m---> \u001b[39m\u001b[32m56\u001b[39m     value = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_cache\u001b[49m\u001b[43m[\u001b[49m\u001b[43mkey\u001b[49m\u001b[43m]\u001b[49m\n\u001b[32m     57\u001b[39m     \u001b[38;5;28mself\u001b[39m._cache.move_to_end(key)\n\n\u001b[31mKeyError\u001b[39m: [<function open at 0x7f9f7f8a6fc0>, ('/your/path/here/uaf_lidar_snowoff.tif',), 'r', (('sharing', False),), 'd2977fa4-7bd9-41e0-a416-b5187c846a51']\n\nDuring handling of the above exception, another exception occurred:\n\n\u001b[31mCPLE_OpenFailedError\u001b[39m                      Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32mrasterio/_base.pyx:310\u001b[39m, in \u001b[36mrasterio._base.DatasetBase.__init__\u001b[39m\u001b[34m()\u001b[39m\n\n\u001b[36mFile \u001b[39m\u001b[32mrasterio/_base.pyx:221\u001b[39m, in \u001b[36mrasterio._base.open_dataset\u001b[39m\u001b[34m()\u001b[39m\n\n\u001b[36mFile \u001b[39m\u001b[32mrasterio/_err.pyx:359\u001b[39m, in \u001b[36mrasterio._err.exc_wrap_pointer\u001b[39m\u001b[34m()\u001b[39m\n\n\u001b[31mCPLE_OpenFailedError\u001b[39m: /your/path/here/uaf_lidar_snowoff.tif: No such file or directory\n\nDuring handling of the above exception, another exception occurred:\n\n\u001b[31mRasterioIOError\u001b[39m                           Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[9]\u001b[39m\u001b[32m, line 7\u001b[39m\n\u001b[32m      4\u001b[39m f_snow_on = \u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[38;5;132;01m{\u001b[39;00mtifpath\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m/uaf_lidar_snowon.tif\u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m      6\u001b[39m \u001b[38;5;66;03m# Load files as rioxarray datasets\u001b[39;00m\n\u001b[32m----> \u001b[39m\u001b[32m7\u001b[39m lidar_snow_off = \u001b[43mrxr\u001b[49m\u001b[43m.\u001b[49m\u001b[43mopen_rasterio\u001b[49m\u001b[43m(\u001b[49m\u001b[43mf_snow_off\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m      8\u001b[39m lidar_snow_on = rxr.open_rasterio(f_snow_on)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/icesat2-cookbook-dev/lib/python3.13/site-packages/rioxarray/_io.py:1135\u001b[39m, in \u001b[36mopen_rasterio\u001b[39m\u001b[34m(filename, parse_coordinates, chunks, cache, lock, masked, mask_and_scale, variable, group, default_name, decode_times, decode_timedelta, band_as_variable, **open_kwargs)\u001b[39m\n\u001b[32m   1133\u001b[39m     \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m   1134\u001b[39m         manager = URIManager(file_opener, filename, mode=\u001b[33m\"\u001b[39m\u001b[33mr\u001b[39m\u001b[33m\"\u001b[39m, kwargs=open_kwargs)\n\u001b[32m-> \u001b[39m\u001b[32m1135\u001b[39m     riods = \u001b[43mmanager\u001b[49m\u001b[43m.\u001b[49m\u001b[43macquire\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m   1136\u001b[39m     captured_warnings = rio_warnings.copy()\n\u001b[32m   1138\u001b[39m \u001b[38;5;66;03m# raise the NotGeoreferencedWarning if applicable\u001b[39;00m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/icesat2-cookbook-dev/lib/python3.13/site-packages/xarray/backends/file_manager.py:201\u001b[39m, in \u001b[36mCachingFileManager.acquire\u001b[39m\u001b[34m(self, needs_lock)\u001b[39m\n\u001b[32m    186\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34macquire\u001b[39m(\u001b[38;5;28mself\u001b[39m, needs_lock: \u001b[38;5;28mbool\u001b[39m = \u001b[38;5;28;01mTrue\u001b[39;00m) -> T_File:\n\u001b[32m    187\u001b[39m \u001b[38;5;250m    \u001b[39m\u001b[33;03m\"\"\"Acquire a file object from the manager.\u001b[39;00m\n\u001b[32m    188\u001b[39m \n\u001b[32m    189\u001b[39m \u001b[33;03m    A new file is only opened if it has expired from the\u001b[39;00m\n\u001b[32m   (...)\u001b[39m\u001b[32m    199\u001b[39m \u001b[33;03m        An open file object, as returned by ``opener(*args, **kwargs)``.\u001b[39;00m\n\u001b[32m    200\u001b[39m \u001b[33;03m    \"\"\"\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m201\u001b[39m     file, _ = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_acquire_with_cache_info\u001b[49m\u001b[43m(\u001b[49m\u001b[43mneeds_lock\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    202\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m file\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/icesat2-cookbook-dev/lib/python3.13/site-packages/xarray/backends/file_manager.py:225\u001b[39m, in \u001b[36mCachingFileManager._acquire_with_cache_info\u001b[39m\u001b[34m(self, needs_lock)\u001b[39m\n\u001b[32m    223\u001b[39m     kwargs = kwargs.copy()\n\u001b[32m    224\u001b[39m     kwargs[\u001b[33m\"\u001b[39m\u001b[33mmode\u001b[39m\u001b[33m\"\u001b[39m] = \u001b[38;5;28mself\u001b[39m._mode\n\u001b[32m--> \u001b[39m\u001b[32m225\u001b[39m file = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_opener\u001b[49m\u001b[43m(\u001b[49m\u001b[43m*\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_args\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    226\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m._mode == \u001b[33m\"\u001b[39m\u001b[33mw\u001b[39m\u001b[33m\"\u001b[39m:\n\u001b[32m    227\u001b[39m     \u001b[38;5;66;03m# ensure file doesn't get overridden when opened again\u001b[39;00m\n\u001b[32m    228\u001b[39m     \u001b[38;5;28mself\u001b[39m._mode = \u001b[33m\"\u001b[39m\u001b[33ma\u001b[39m\u001b[33m\"\u001b[39m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/icesat2-cookbook-dev/lib/python3.13/site-packages/rasterio/env.py:463\u001b[39m, in \u001b[36mensure_env_with_credentials.<locals>.wrapper\u001b[39m\u001b[34m(*args, **kwds)\u001b[39m\n\u001b[32m    460\u001b[39m     session = DummySession()\n\u001b[32m    462\u001b[39m \u001b[38;5;28;01mwith\u001b[39;00m env_ctor(session=session):\n\u001b[32m--> \u001b[39m\u001b[32m463\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mf\u001b[49m\u001b[43m(\u001b[49m\u001b[43m*\u001b[49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwds\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/icesat2-cookbook-dev/lib/python3.13/site-packages/rasterio/__init__.py:356\u001b[39m, in \u001b[36mopen\u001b[39m\u001b[34m(fp, mode, driver, width, height, count, crs, transform, dtype, nodata, sharing, opener, **kwargs)\u001b[39m\n\u001b[32m    353\u001b[39m     path = _parse_path(raw_dataset_path)\n\u001b[32m    355\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m mode == \u001b[33m\"\u001b[39m\u001b[33mr\u001b[39m\u001b[33m\"\u001b[39m:\n\u001b[32m--> \u001b[39m\u001b[32m356\u001b[39m     dataset = \u001b[43mDatasetReader\u001b[49m\u001b[43m(\u001b[49m\u001b[43mpath\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mdriver\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdriver\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43msharing\u001b[49m\u001b[43m=\u001b[49m\u001b[43msharing\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    357\u001b[39m \u001b[38;5;28;01melif\u001b[39;00m mode == \u001b[33m\"\u001b[39m\u001b[33mr+\u001b[39m\u001b[33m\"\u001b[39m:\n\u001b[32m    358\u001b[39m     dataset = get_writer_for_path(path, driver=driver)(\n\u001b[32m    359\u001b[39m         path, mode, driver=driver, sharing=sharing, **kwargs\n\u001b[32m    360\u001b[39m     )\n\n\u001b[36mFile \u001b[39m\u001b[32mrasterio/_base.pyx:312\u001b[39m, in \u001b[36mrasterio._base.DatasetBase.__init__\u001b[39m\u001b[34m()\u001b[39m\n\n\u001b[31mRasterioIOError\u001b[39m: /your/path/here/uaf_lidar_snowoff.tif: No such file or directory","ename":"RasterioIOError","evalue":"/your/path/here/uaf_lidar_snowoff.tif: No such file or directory"}],"key":"sgoqo84rWs"}],"key":"ECRF51I7cc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"It is not immediately obvious, but the uAF rasters are in a different spatial projection than ICESat-2. UAF is in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jW55SQSPKZ"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"EPSG:32606","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hhEnYi746R"}],"key":"XKteI6B7dS"},{"type":"text","value":", and ICESat-2 is in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n6aqWXLfp7"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"WGS84/EPSG:4326","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tN2ryeNAa0"}],"key":"jMNJ2p4UwB"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RI5jQJUgkx"}],"key":"cuGMiU4Hk1"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In order to directly compare these two datasets, we are going to add reprojected coordinates to the ICESat-2 GeoDataFrame. In essence, we will go from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xSIUiUuAfT"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"latitude/longitude","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UY5NyW6lJs"}],"key":"qPYyj0v8Vi"},{"type":"text","value":" to ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AuXYzmmVi1"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"northing/easting","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AFz1uHFDWZ"}],"key":"nYtI164mMr"},{"type":"text","value":". Luckily, there is an easy way to do this with GeoPandas, specifically with the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"k2VGQxU7Hj"},{"type":"inlineCode","value":"geopandas.to_crs()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qSMY9hHbPL"},{"type":"text","value":" function.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"izOtYtKb02"}],"key":"KkmRJO9LQ6"}],"key":"nx45OqXOnx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Initialize ICESat-2 coordinate projection\nis2_df_subset = is2_df_subset.set_crs(\"EPSG:4326\")\n\n# Change to EPSG:32606\nis2_df_subset = is2_df_subset.to_crs(\"EPSG:32606\")\n\n# Display top of dataframe\nprint(is2_df_subset.head())","key":"Gh2iryLPq7"},{"type":"output","id":"PubSKArnKHJTfh8GHkOaQ","data":[],"key":"kDik4nGHjb"}],"key":"PBA8V581ws"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Co-register rasters and ICESat-2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vebHldp5KP"}],"identifier":"co-register-rasters-and-icesat-2","label":"Co-register rasters and ICESat-2","html_id":"co-register-rasters-and-icesat-2","implicit":true,"key":"eTNTa5PfV0"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Now, we are going to co-register both rasters to the queried ICESat-2 data. The function below is fairly long, but the gist is that we a re using a spline interpolant to match both the snow-off UAF data (surface height) and UAF snow depths with ICESat-2 surface heights. The resulting GeoDataFrame will have both ICESat-2 and UAF data in it.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oimxcIlQtc"}],"key":"tp8JKOpFSa"}],"key":"GGxRN6hi2b"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Make coregistration function\ndef coregister_is2(lidar_snow_off, lidar_snow_on, is2_df):\n    \"\"\"\n    Co-registers UAF data with ICESat-2 data with a rectangular \n    bivariate spline.\n\n    Parameters\n    ------------\n    lidar_snow_off: rioxarray dataset\n        Lidar DEM/DTM in rioxarray format.\n    lidar_snow_on: rioxarray dataset\n        Lidar-derived snow depth in rioxarray format.\n    is2_df: GeodataFrame\n        GeoDataFrame for the ICESat-2 data generated with SlideRule.\n\n    Returns\n    ------------\n    is2_uaf_df: GeoDataFrame\n        Contains the coordinate and elevation data that matches best\n        between ICESat-2 and UAF.\n    \"\"\"\n\n    # Helper function to prepare lidar data\n    def prepare_lidar_data(raster):\n        coords_x = np.array(raster.x)\n        coords_y = np.array(raster.y)\n        values = np.array(raster.sel(band=1))[::-1, :]\n        values[np.isnan(values)] = -9999\n        return coords_x, coords_y, values\n\n    # Get coordinates and height/depth values from lidar data\n    x0, y0, dem_heights = prepare_lidar_data(lidar_snow_off)\n    xs, ys, dem_depths = prepare_lidar_data(lidar_snow_on)\n\n    # Generate interpolators\n    interp_height = RectBivariateSpline(y0[::-1], x0, dem_heights)\n    interp_height = RectBivariateSpline(ys[::-1], xs, dem_depths)\n\n    # Pre-filter IS2 data to bounds (apply once instead of per beam)\n    x_bounds = (is2_df.geometry.x > np.min(x0)) & (is2_df.geometry.x < np.max(x0))\n    y_bounds = (is2_df.geometry.y > np.min(y0)) & (is2_df.geometry.y < np.max(y0))\n    is2_filtered = is2_df[x_bounds & y_bounds].copy()\n\n    if is2_filtered.empty:\n        print('Error with GeoDataFrame or raster bounds.')\n        return gpd.GeoDataFrame()\n\n    # Extract coordinates once\n    xn = is2_filtered.geometry.x.values\n    yn = is2_filtered.geometry.y.values\n\n    # Estimate lidar height and snow depth at the ICESat-2 coordinates\n    lidar_heights = interp_height(yn, xn, grid=False)\n    lidar_snow_depths = interp_depth(yn, xn, grid=False)\n\n    # Create result DataFrame in one operation\n    is2_uaf_df = gpd.GeoDataFrame({\n        'x': xn,\n        'y': yn,\n        'time': is2_filtered.index.values,\n        'beam': is2_filtered['gt'].values,\n        'lidar_height': lidar_heights,\n        'lidar_snow_depth': lidar_snow_depths,\n        'is2_height': is2_filtered['h_mean'].values,\n        'h_sigma': is2_filtered['h_sigma'].values,\n        'dh_fit_dx': is2_filtered['dh_fit_dx'].values\n    })\n\n    # Add coordinate transformation\n    transformer = Transformer.from_crs(\"EPSG:32606\", \"EPSG:4326\", always_xy=True)\n    is2_uaf_df['lon'], is2_uaf_df['lat'] = transformer.transform(\n        is2_uaf_df['x'], is2_uaf_df['y']\n    )\n\n    return is2_uaf_df","key":"RMN9vvZoOJ"},{"type":"output","id":"UQrE98GhzOk_wpxW_-IbK","data":[],"key":"tuBfMu7Lea"}],"key":"oEdKMlD7A3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Co-locate ICESat-2 and UAF using the above function\nis2_uaf_df = coregister_is2(lidar_snow_off, \n                            lidar_snow_on, \n                            is2_df_subset\n                           )\n# Convert to a GeoDataFrame\ngeom = gpd.points_from_xy(is2_uaf_df.lon, is2_uaf_df.lat)\nis2_uaf_gdf = gpd.GeoDataFrame(is2_uaf_df,\n                               geometry=geom,\n                               crs=\"EPSG:4326\"\n                              )\n# Print head of GeoDataFrame\nis2_uaf_gdf.head()","key":"tX542WBzAQ"},{"type":"output","id":"PhYhDK_9UMRunShvmA629","data":[],"key":"zDXpXP7EHn"}],"key":"coaUnrngdb"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As one can see, we now have a GeoDataFrame that includes several useful variables:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dTRPLIOLqX"}],"key":"ofPvxDXbj8"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"beam","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"C0igf8cu5Y"},{"type":"text","value":": ICESat-2 beam (gt1l, gt2l, etc.)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ZP1OnHh1Qh"}],"key":"dOwVyIOfIk"}],"key":"ebYzvlCA01"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"lidar_height","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pH0vycVWHm"},{"type":"text","value":": Snow-off surface height from UAF lidar.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BvIJrDEt0R"}],"key":"EpFFJUzChC"}],"key":"HXQOMp2rOE"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"lidar_snow_depth","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"xvPQwtycNx"},{"type":"text","value":": Snow depth derived from UAF.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"F5tpNX30XJ"}],"key":"eErTazjFuy"}],"key":"JQTiooAgb2"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"is2_height","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"tkGJNZ7AyK"},{"type":"text","value":": ICESat-2 surface height (snow-on, in this case).","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zycJqtakgQ"}],"key":"K1aSKwbQJX"}],"key":"EnQEKaEm2m"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"h_sigma","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ll4ju8ro3m"},{"type":"text","value":": ICESat-2 height uncertainty.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ojlMoUZjYN"}],"key":"mcYSupXcpa"}],"key":"IGgpyFLlq7"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"dh_fit_dx","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"j678F1yOAA"},{"type":"text","value":": Along-track slope of the terrain.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dEAgtU4Uu3"}],"key":"gK8ZqoZIdf"}],"key":"BCWizePxCi"}],"key":"cgraj5hdwe"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"With this GeoDataFrame, it is very simple to derive snow depth!","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"WEp6IO12g1"}],"key":"VvndGpw2gL"}],"key":"u3nicks6zo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Derive snow depth using snow-on/snow-off differencing\nis2_uaf_gdf['is2_snow_depth'] = is2_uaf_gdf['is2_height'] - is2_uaf_gdf['lidar_height']\n\n# Estimate the residual (bias) between IS-2 and UAF depths\nis2_uaf_gdf['snow_depth_residual'] = is2_uaf_gdf['is2_snow_depth'] - is2_uaf_gdf['lidar_snow_depth']","key":"KivsagvpHp"},{"type":"output","id":"cIBZcdpkXxNaYXI4a81yA","data":[],"key":"z8qsexz8X9"}],"key":"EERiGPJ2Me"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Horray! We finally have ICESat-2 snow depths! Let’s make a couple of plots with the data we have.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MIuwpB8Agm"}],"key":"qK3yS6AqIA"}],"key":"DZDWfySHy9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Map Plot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"anDkztgjTt"}],"identifier":"map-plot","label":"Map Plot","html_id":"map-plot","implicit":true,"key":"F51fGSUzWB"}],"key":"YiuQChJi37"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Create plot\nfig, ax = plt.subplots(figsize=(12, 8))\n# Plot surface height\nis2_uaf_gdf.to_crs(\"EPSG:3857\").plot(column='is2_snow_depth', \n                  ax=ax, \n                  cmap='viridis',\n                  legend=True,\n                  markersize=10,\n                  alpha=0.8)\n\n# Plot the region bounding box\nregion_mercator.plot(ax=ax, \n                     facecolor='none', \n                     edgecolor='red', \n                     linewidth=2)\n\n# Add ESRI World Imagery basemap\nctx.add_basemap(ax, \n                crs=\"EPSG:3857\", \n                source=ctx.providers.Esri.WorldImagery)\nplt.tight_layout()\nplt.show()","key":"RcgtPkW9Bu"},{"type":"output","id":"nF1prgsCT1vXZrLPlIwyQ","data":[],"key":"iVceNoUfja"}],"key":"Fi8S5Rydpj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Along-track plots","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SRH3Hc5CVg"}],"identifier":"along-track-plots","label":"Along-track plots","html_id":"along-track-plots","implicit":true,"key":"ue1TSBcGTb"}],"key":"KkgHMyYxTz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Plot snow depths for the three strong beams\nfig,axs = plt.subplots(3)\n\n#Left strong beam\ntmp_df = is2_uaf_gdf[is2_uaf_gdf['beam']==10]\naxs[0].plot(tmp_df['lat'], tmp_df['is2_snow_depth'], label='ICESat-2')\naxs[0].plot(tmp_df['lat'], tmp_df['lidar_snow_depth'], label='UAF')\naxs[0].set_title('gt1l')\naxs[0].legend()\n\n# Central strong beam\ntmp_df = is2_uaf_gdf[is2_uaf_gdf['beam']==30]\naxs[1].plot(tmp_df['lat'], tmp_df['is2_snow_depth'])\naxs[1].plot(tmp_df['lat'], tmp_df['lidar_snow_depth'])\naxs[1].set_ylabel('Snow depth [m]', fontsize=18)\naxs[1].set_title('gt2l')\n\n# Right strong beam\ntmp_df = is2_uaf_gdf[is2_uaf_gdf['beam']==50]\naxs[2].plot(tmp_df['lat'], tmp_df['is2_snow_depth'])\naxs[2].plot(tmp_df['lat'], tmp_df['lidar_snow_depth'])\naxs[2].set_xlabel('Latitude [m]', fontsize=18)\naxs[2].set_title('gt3l')\nplt.tight_layout()\n\n# Only include outer axis labels\nfor ax in axs:\n    ax.label_outer()\n    ax.set_ylim([0, 1.5])","key":"ChNrkbxcNf"},{"type":"output","id":"NTWzCBcWnf8r0JVLdxb6L","data":[],"key":"XjdtZwYAjs"}],"key":"IvZ7Z5GQW4"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Scatter Plot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fgw6QqVPXU"}],"identifier":"scatter-plot","label":"Scatter Plot","html_id":"scatter-plot","implicit":true,"key":"QMIZvKKOSv"}],"key":"NGuqxKvJDw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(figsize=(12,6))\ns = is2_uaf_gpd.plot.scatter(ax=ax,\n                             x='lidar_snow_depth',\n                             y='is2_snow_depth',\n                             c='snow_depth_residual',\n                             vmin=-0.5, vmax=0.5\n                            )\nax.set_xlabel(\"UAF snow depth [m]\", fontsize=18)\nax.set_ylabel(\"ICESat-2 snow depth [m]\", fontsize=18)\nax.set_xlim([0, 1.5])\nax.set_ylim([0, 1.5])\ncbar = fig.colorbar(s, ax=ax)\ncbar.set_label(\"Snow depth residual [m]\")\nplt.tight_layout()","key":"nuzA21zc1A"},{"type":"output","id":"lpuCohmffT-lHaTSnwfhN","data":[],"key":"z7yokrd8m2"}],"key":"UqP5C5k0cr"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VyieQSK2Cl"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"wjettPnEVB"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"🎉 Congratulations! You have completed this tutorial and have seen how to compare ICESat-2 to raster data, how to obtain ICESat-2 data with SlideRule, and how to calculate snow depths from ICESat-2 data.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"FzlLUVvcWU"}],"key":"zlhKdkuj5k"}],"key":"F4G2sqXqPQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Reference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qkdevrkHz7"}],"identifier":"reference","label":"Reference","html_id":"reference","implicit":true,"key":"vmFgIyq2J6"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To further explore the topics of this tutorial, see the following detailed documentation: (TODO: ADD LINKS TO SITES AND PAPERS)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"F1w0WqQ9Se"}],"key":"EsLt3lDufh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"SlideRule Website","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AtkwGqv6fs"}],"key":"jNw2V1ULAT"}],"key":"KoLQcBvbYZ"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"SlideRule online demo","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"XB6lMay627"}],"key":"k1BWZumWkT"}],"key":"Ks0d1Rqm9d"}],"key":"yGESYd0xY9"},{"type":"heading","depth":3,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Papers","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"eF1tH5zCpE"}],"identifier":"papers","label":"Papers","html_id":"papers","implicit":true,"key":"P13L57nPNQ"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Deems, Jeffrey S., et al. “Lidar Measurement of Snow Depth: A Review.” Journal of Glaciology, vol. 59, no. 215, 2013, pp. 467–79. ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dkCIdXpL3V"},{"type":"link","url":"http://DOI.org","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"DOI.org","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"psjd44eV6n"}],"urlSource":"http://DOI.org","key":"YYkcn2ySHR"},{"type":"text","value":" (Crossref), ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Re3EPxx9Wb"},{"type":"cite","url":"https://doi.org/10.3189/2013JoG12J154","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Deems ","key":"nId7MNcD5I"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"bU5xsylxlx"}],"key":"Z4ddfkX5ye"},{"type":"text","value":" (2013)","key":"hDSwT6u8fd"}],"kind":"narrative","label":"Deems_2013","identifier":"https://doi.org/10.3189/2013JoG12J154","enumerator":"1","key":"ktE9xfo2Bk"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"A1mD3H9HMV"}],"key":"KnPi2qc9ZZ"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Nuth, C., and A. Kääb. “Co-Registration and Bias Corrections of Satellite Elevation Data Sets for Quantifying Glacier Thickness Change.” The Cryosphere, vol. 5, no. 1, Mar. 2011, pp. 271–90. ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"oeraNvBX3k"},{"type":"link","url":"http://DOI.org","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"DOI.org","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"BCugGD6pqd"}],"urlSource":"http://DOI.org","key":"wG9HBLLcsy"},{"type":"text","value":" (Crossref), ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"mFL26SWx1A"},{"type":"cite","url":"https://doi.org/10.5194/tc-5-271-2011","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Nuth & Kääb (2011)","key":"S2yrOMiO9O"}],"kind":"narrative","label":"Nuth_2011","identifier":"https://doi.org/10.5194/tc-5-271-2011","enumerator":"2","key":"APAWBzuB3Q"},{"type":"text","value":".","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"rRGcKq4Eet"}],"key":"GkOQJpHBey"}],"key":"TVjwYk8Wu1"}],"key":"BaIVv7ixXi"},"references":{"cite":{"order":["Deems_2013","Nuth_2011"],"data":{"Deems_2013":{"label":"Deems_2013","enumerator":"1","doi":"10.3189/2013jog12j154","html":"Deems, J. S., Painter, T. H., & Finnegan, D. C. (2013). Lidar measurement of snow depth: a review. <i>Journal of Glaciology</i>, <i>59</i>(215), 467–479. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.3189/2013jog12j154\">10.3189/2013jog12j154</a>","url":"https://doi.org/10.3189/2013jog12j154"},"Nuth_2011":{"label":"Nuth_2011","enumerator":"2","doi":"10.5194/tc-5-271-2011","html":"Nuth, C., & Kääb, A. (2011). Co-registration and bias corrections of satellite elevation data sets for quantifying glacier thickness change. <i>The Cryosphere</i>, <i>5</i>(1), 271–290. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.5194/tc-5-271-2011\">10.5194/tc-5-271-2011</a>","url":"https://doi.org/10.5194/tc-5-271-2011"}}}},"footer":{"navigation":{"prev":{"title":"DRAFT: Bathymetry Applications","url":"/notebooks/bathymetry","group":"Example Workflows"},"next":{"title":"Awesome ICESat-2","url":"/additional-resources/awesome","group":"Additional Resources"}}},"domain":"http://localhost:3000"}